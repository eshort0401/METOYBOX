<div id="del_phi">
    <div id="loading-screen">
        <div class="spinner"></div>
        <p>Loading...</p>
        <p><small>This can take a few minutes!</small></p>
    </div>
    <div id="main-content">
        <div id="scale-table"></div>
        <div id="controls"></div>
        <script>
            (function(containerID) {
                // Setup constants
                const c_p = 1005; // J kg^-1 K^-1
                const c_v = 718; // J kg^-1 K^-1
                const gamma = c_p / c_v;
                const R = c_p - c_v; // J kg^-1 K^-1
                const g = 9.81; // m s^-2
                const Omega = (2 * Math.PI) / (24 * 3600); // rad s^-1
                
                // Define reference values
                const p_s = 1e5; // Pa
                const T_s = 300; // K
                const rho_s = p_s / (R * T_s); // Ideal gas law
                
                /**
                 * Calculate the terms for the scale analysis table
                 * @param {number} del_p
                 * @param {number} p_bar
                 * @param {number} del_rho
                 * @param {number} rho_bar
                 * @returns
                 */
                function calculateTableValues(del_p, p_bar, del_rho, rho_bar) {
                    const del_phi_exact =
                        (1 / gamma) * Math.log((p_bar + del_p) / p_bar) -
                        Math.log((rho_bar + del_rho) / rho_bar);
                    const del_phi_1 = (1 / gamma) * (del_p / p_bar);
                    const del_phi_2 = -(del_rho / rho_bar);
                    const R_1 = (1 / gamma) * Math.log((p_bar + del_p) / p_bar) - del_phi_1;
                    const R_2 = -Math.log((rho_bar + del_rho) / rho_bar) - del_phi_2;
                    return [[del_phi_1, R_1, del_phi_2, R_2]];
                }
                
                // Create container for the table
                let tableIndentifer = `#${containerID} #main-content #scale-table`;
                const table_container = document.querySelector(tableIndentifer);
                
                // Create sliders to control scales. Note sliders are logarithmic, but values
                // stored in scaleTable are linear.
                
                // Store the initial exponents and values for each slider
                const initialExponents = [4, 5, -1, 0];
                const initialSliderValues = initialExponents.map((exp) => Math.pow(10, exp));
                
                // 1e3 Pa = 10 hPa
                let args = [`${containerID}-del_p-slider`, `${containerID}-del_p-output`];
                args.push("\\(\\delta p:\\)", 0, 6, initialExponents[0]);
                args.push(0.1, null, "Pa");
                const delPSliderRow = createSliderRow(...args);
                
                args = [`${containerID}-p_bar-slider`, `${containerID}-p_bar-output`];
                // 1e5 Pa = 1000 hPa = 1 bar
                args.push("\\(\\overline{p}:\\)", 0, 6, initialExponents[1]);
                args.push(0.1, null, "Pa");
                const pBarSliderRow = createSliderRow(...args);
                
                args = [`${containerID}-del_rho-slider`, `${containerID}-del_rho-output`];
                args.push("\\(\\delta \\rho:\\)", -3, 0.5, initialExponents[2], 0.1);
                args.push(null, "kg m⁻³");
                const delRhoSliderRow = createSliderRow(...args);
                
                args = [`${containerID}-rho_bar-slider`, `${containerID}-rho_bar-output`];
                args.push("\\(\\overline{\\rho}:\\)", -3, 0.5, initialExponents[3], 0.1);
                args.push(null, "kg m⁻³");
                const rhoBarSliderRow = createSliderRow(...args);
                
                let allSliders = [delPSliderRow, pBarSliderRow];
                allSliders.push(delRhoSliderRow, rhoBarSliderRow);
                // Fix the initial slider output formats
                initializeValues(allSliders);
                
                // Now append all the slider rows to the controls container
                let controlsIdentifier = `#${containerID} #main-content #controls`;
                const controls = document.querySelector(controlsIdentifier);
                controls.append(...allSliders);
                
                // Build the scale table
                const initialTableValues = calculateTableValues(...initialSliderValues);
                const scaleTable = new ScaleTable(
                    containerID,
                    [
                        [
                            "\\frac{1}{\\gamma}\\frac{\\delta p}{\\overline{p}}",
                            "R_1",
                            "-\\frac{\\delta \\rho}{\\overline{\\rho}}",
                            "R_2",
                        ],
                    ],
                    initialTableValues,
                    [["", "", "", ""]] // Everything unitless in this case
                );
                scaleTable.id = `${containerID}-scale-table`;
                table_container.appendChild(scaleTable.table);
                
                // Setup the listeners
                let sliderIDs = [`${containerID}-del_p-slider`, `${containerID}-p_bar-slider`];
                sliderIDs.push(`${containerID}-del_rho-slider`);
                sliderIDs.push(`${containerID}-rho_bar-slider`);
                addListeners(sliderIDs, calculateTableValues, scaleTable);
                
                // Hide loading screen and show main content
                const container = document.querySelector(`#${containerID}`);
                const loading_screen = container.querySelector("#loading-screen");
                const main_content = container.querySelector("#main-content");
                
                loading_screen.style.display = "none";
                main_content.style.display = "block";
                
                container.classList.add("dimensional-mode");
            })('del_phi');
        </script>
    </div>
</div>